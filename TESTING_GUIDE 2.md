# 🧪 中文字幕同步測試指南

## 快速測試步驟

### 1️⃣ 基礎功能測試

**步驟：**
1. 打開 App
2. 切換到中文模式
3. 點擊麥克風按鈕
4. 問：「什麼是大象？」
5. 觀察字幕同步效果

**檢查點：**
- ✅ 字幕是否立即開始（不延遲）
- ✅ 正在唸的字是否變紅色並放大
- ✅ 已唸過的字是否變藍色
- ✅ 字幕與語音是否同步
- ✅ 結尾是否精準收尾（不拖延）

---

### 2️⃣ 卡拉OK效果測試

**步驟：**
1. 問一個較長的問題：「為什麼天空是藍色的？」
2. 仔細觀察每個字的顏色變化

**預期效果：**
```
灰色（未唸） → 紅色（正在唸）+ 放大 → 藍色（已唸）
```

**檢查點：**
- ✅ 顏色變化平滑
- ✅ 放大動畫有彈性
- ✅ 藍色光暈明顯
- ✅ 字重變化清晰

---

### 3️⃣ 標點符號停頓測試

**步驟：**
問：「大象很大，牠們住在非洲。牠們喜歡吃草嗎？」

**檢查點：**
- ✅ 逗號（，）處：輕微減速
- ✅ 句號（。）處：明顯減速
- ✅ 問號（？）處：明顯減速
- ✅ 整體感覺自然

---

### 4️⃣ 長文本測試

**步驟：**
問：「請告訴我恐龍的故事」（AI 會回答很長的內容）

**檢查點：**
- ✅ 全程無跳躍
- ✅ 滾動平滑
- ✅ 字幕始終在中間（自動滾動）
- ✅ 結尾精準

---

### 5️⃣ 特殊字符測試

**步驟：**
問：「2024年有什麼重要的事？」

**檢查點：**
- ✅ 數字（2024）正常高亮
- ✅ 英文字母正常高亮
- ✅ 整體同步不受影響

---

## 🐛 常見問題排查

### 問題 1：字幕完全不動
**可能原因：**
- `currentWordIndex` 沒更新
- Timer 沒啟動

**排查：**
檢查 Console 是否有 `[TTS][ZH]` 的 log

### 問題 2：字幕跳太快
**可能原因：**
- alpha 值太大
- 權重計算錯誤

**排查：**
查看 log 中的 `alpha=` 值

### 問題 3：開頭延遲太久
**可能原因：**
- `leadingSilence` 設太大

**排查：**
查看 log 中的 `leadingSilence=` 值

### 問題 4：卡拉OK效果不明顯
**可能原因：**
- 顏色對比度不夠
- 放大倍數太小

**調整：**
修改 `ChineseCharacterView` 中的：
```swift
.scaleEffect(isCurrent && isPlaying ? 1.3 : 1.0)  // 改成 1.3
.foregroundColor(isCurrent ? .red : ...)  // 改成純紅色
```

---

## 📊 Debug Log 說明

### 正常的 Log 範例
```
[TTS] duration=3.25s, textLen=45
🎵 中文字幕同步：原始文字 45 字 → 實際發音 40 字
[TTS][ZH] speedPerChar=0.081s, alpha=0.15
[TTS][ZH] leadingSilence=0.25s, trailingSilence=0.20s
[TTS][ZH] t=0.5/2.8 idx=20/40 alpha=0.15
[TTS][ZH] t=1.0/2.8 idx=28/40 alpha=0.15
[TTS][ZH] t=1.5/2.8 idx=32/40 alpha=0.15
[TTS][ZH] t=2.0/2.8 idx=36/40 alpha=0.15
[TTS][ZH] t=2.5/2.8 idx=39/40 alpha=0.15
[TTS][ZH] t=2.8/2.8 idx=40/40 alpha=0.15
```

**解讀：**
- `duration`: 音訊總長 3.25 秒
- `textLen`: 原始文字 45 字（包含標點）
- `實際發音`: 40 字（排除標點）
- `speedPerChar`: 每字 0.081 秒（快速）
- `alpha`: 0.15（快速響應）
- `leadingSilence`: 開頭靜音 0.25 秒
- `t=2.0/2.8`: 實際播放時間 2.0 秒 / 調整後總時長 2.8 秒
- `idx=36/40`: 目前在第 36 字 / 總共 40 字

---

## ✅ 驗收標準

### 基礎要求
- [ ] 字幕與語音同步誤差 < 0.2 秒
- [ ] 無明顯跳躍或卡頓
- [ ] 開頭延遲 < 0.3 秒
- [ ] 結尾無拖延

### 進階要求
- [ ] 卡拉OK效果明顯（紅色 → 藍色）
- [ ] 放大動畫流暢
- [ ] 標點處自動減速
- [ ] 長文本全程平滑

### 完美標準
- [ ] 字幕與語音完全同步（誤差 < 0.1 秒）
- [ ] 視覺效果驚艷（光暈、動畫）
- [ ] 標點停頓自然（如真人朗讀）
- [ ] 適應各種語速（快/中/慢）

---

## 🎬 錄製測試影片

**建議：**
1. 使用螢幕錄影功能
2. 同時錄製聲音
3. 測試 3-5 個不同問題
4. 觀看慢動作（0.5 倍速）檢查同步

**重點檢查：**
- 開頭是否立即開始
- 中間是否平滑
- 標點處是否減速
- 結尾是否精準

---

**祝測試順利！🎉**
