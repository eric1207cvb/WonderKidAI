# 🔄 介紹按鈕功能說明

## 功能概述

右下角的圓形按鈕會根據使用狀態動態改變文字和行為：

### 第一次使用時
- **按鈕文字**：介紹 / Intro / 紹介
- **點擊行為**：播放安安老師的自我介紹

### 使用中（已播放過介紹）
- **按鈕文字**：聽不懂 / Again / もう一度
- **點擊行為**：用更簡單的方式重新解釋上一個問題

### 退出程式後重新進入
- **按鈕文字**：介紹 / Intro / 紹介（重置狀態）
- **點擊行為**：再次播放自我介紹

---

## 🎯 使用場景示範

### 場景 1：第一次使用（中文）

1. **打開 App**
   - 看到按鈕顯示：「介紹」
   
2. **點擊「介紹」按鈕**
   - 安安老師說：「嗨！我是安安老師，你的第一本 AI 百科全書...」
   - 播放完畢後，按鈕變成：「聽不懂」

3. **問問題**
   - 用戶：「什麼是大象？」
   - 安安老師回答關於大象的知識

4. **點擊「聽不懂」**
   - 安安老師用更簡單的比喻重新解釋

---

### 場景 2：切換語言

1. **從中文切換到日文**
   - 按鈕顯示：「紹介」（因為日文還沒播放過介紹）

2. **點擊「紹介」**
   - 安安老師用日文自我介紹
   - 播放完畢後，按鈕變成：「もう一度」

3. **切換回中文**
   - 按鈕顯示：「聽不懂」（中文已經播放過介紹了）

---

### 場景 3：退出後重新進入

1. **使用中**
   - 按鈕顯示：「聽不懂」

2. **關閉 App（進入背景）**
   - 狀態重置

3. **重新打開 App**
   - 按鈕顯示：「介紹」
   - 點擊後再次播放自我介紹

---

## 🔧 技術實現

### 狀態變數

```swift
@State private var hasPlayedChineseIntro: Bool = false
@State private var hasPlayedEnglishIntro: Bool = false
@State private var hasPlayedJapaneseIntro: Bool = false
```

### 重置邏輯

```swift
.onChange(of: scenePhase) { newPhase in
    if newPhase == .background {
        // 退出程式時重置所有介紹狀態
        hasPlayedChineseIntro = false
        hasPlayedEnglishIntro = false
        hasPlayedJapaneseIntro = false
    }
}
```

### 按鈕文字判斷

```swift
func getAgainButtonText() -> String {
    if needsIntro() {
        // 顯示「介紹」
        switch selectedLanguage {
        case .chinese: return "介紹"
        case .english: return "Intro"
        case .japanese: return "紹介"
        }
    } else {
        // 顯示「聽不懂」
        switch selectedLanguage {
        case .chinese: return "聽不懂"
        case .english: return "Again"
        case .japanese: return "もう一度"
        }
    }
}
```

### 點擊行為

```swift
func askExplainAgain() {
    // 1. 檢查免費額度
    if !subManager.isPro && !checkFreeQuota() {
        triggerPaywall()
        return
    }
    
    // 2. 優先判斷：如果還沒播放過介紹，就播放介紹
    if needsIntro() {
        playIntroMessage()
        return
    }
    
    // 3. 已經播放過介紹，執行「聽不懂」邏輯
    if lastQuestion.isEmpty {
        playIntroMessage() // 沒有問題時，再播一次介紹
        return
    }
    
    // 4. 有問題時，用更簡單的方式重新解釋
    let prompt = localizedText.simplerExplanationPrompt(for: lastQuestion)
    userSpokenText = localizedText.simplerExplanationRequest
    sendToAI(question: prompt)
}
```

---

## 📋 測試清單

### ✅ 測試 1：第一次使用
- [ ] 打開 App，按鈕顯示「介紹」
- [ ] 點擊後播放自我介紹
- [ ] 播放完畢後按鈕變成「聽不懂」

### ✅ 測試 2：切換語言
- [ ] 中文介紹播放完 → 切換到英文 → 按鈕顯示「Intro」
- [ ] 英文介紹播放完 → 切換到日文 → 按鈕顯示「紹介」
- [ ] 日文介紹播放完 → 切換回中文 → 按鈕顯示「聽不懂」

### ✅ 測試 3：退出重置
- [ ] 使用中按鈕顯示「聽不懂」
- [ ] 退出 App（按 Home 鍵或切換到其他 App）
- [ ] 重新進入 App，按鈕顯示「介紹」

### ✅ 測試 4：聽不懂功能
- [ ] 問問題：「什麼是太陽？」
- [ ] 點擊「聽不懂」→ 安安老師用更簡單的方式重新解釋
- [ ] 確認沒有重複上一次的答案

### ✅ 測試 5：沒有問題時
- [ ] 第一次使用，點擊「介紹」→ 播放介紹
- [ ] 介紹播放完，還沒問問題，點擊「聽不懂」→ 再次播放介紹

---

## 🎨 UI 顯示

### 按鈕外觀
```
┌─────────────┐
│  🔄         │ ← 旋轉箭頭圖示
│  介紹       │ ← 動態文字
└─────────────┘
```

### 不同狀態的文字

| 語言 | 第一次/重進入 | 使用中 |
|-----|------------|--------|
| 中文 | 介紹 | 聽不懂 |
| 英文 | Intro | Again |
| 日文 | 紹介 | もう一度 |

---

## 🔄 完整流程圖

```
┌─────────────┐
│  打開 App   │
└──────┬──────┘
       │
       ▼
  ┌─────────────┐
  │ needsIntro? │
  └──────┬──────┘
         │
    ┌────┴────┐
    │         │
   YES       NO
    │         │
    ▼         ▼
 ┌──────┐  ┌──────┐
 │ 介紹 │  │聽不懂│
 └───┬──┘  └───┬──┘
     │         │
     ▼         ▼
 ┌────────┐ ┌────────┐
 │播放介紹│ │簡化解釋│
 └───┬────┘ └────────┘
     │
     ▼
 ┌────────────┐
 │ 設定已播放 │
 └────────────┘
```

---

## 💡 設計理念

### 為什麼這樣設計？

1. **新手友善**
   - 第一次使用時，孩子可能不知道該做什麼
   - 「介紹」按鈕提供明確的入口，讓安安老師自我介紹

2. **重複使用時更自然**
   - 已經認識安安老師後，按鈕變成「聽不懂」更符合使用場景
   - 孩子聽不懂回答時，可以請老師用更簡單的方式說明

3. **每次進入都有歡迎感**
   - 退出後重新進入，按鈕重置為「介紹」
   - 像老師每次見面都會重新打招呼一樣親切

4. **多語言獨立記憶**
   - 每種語言的介紹狀態分開記錄
   - 切換語言時，如果還沒聽過該語言的介紹，會自動提示

---

## 🐛 邊界情況處理

### 情況 1：免費額度用完
- 點擊「介紹」或「聽不懂」時，優先檢查額度
- 額度不足時，顯示付費提示，不會播放介紹

### 情況 2：沒有問過問題
- 第一次使用：點擊「介紹」→ 播放介紹
- 介紹播放完，但沒問問題：點擊「聽不懂」→ 再次播放介紹

### 情況 3：正在播放中
- 按鈕會隱藏，避免重複點擊

### 情況 4：正在錄音/思考中
- 按鈕會隱藏，避免干擾主要操作

---

## ✨ 未來優化建議

1. **動畫效果**
   - 按鈕文字改變時加入淡入淡出動畫
   - 播放介紹時按鈕可以有脈動效果

2. **長按功能**
   - 長按按鈕可以跳過介紹，直接進入提問模式

3. **自訂介紹**
   - 進階設定中可以選擇「簡短版」或「完整版」介紹

4. **介紹次數統計**
   - 記錄每個語言播放介紹的次數
   - 第 3 次以後可以自動跳過介紹

---

**🎊 功能實現完成！**
